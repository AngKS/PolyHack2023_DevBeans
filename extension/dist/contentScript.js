let timeoutId=null,maxElementWidth=.8*document.documentElement.clientWidth;const overlayButton=document.createElement("button");overlayButton.innerText="",overlayButton.style.position="absolute",overlayButton.style.zIndex="2147483647",overlayButton.style.background="#F1FCFE",overlayButton.style.color="#3b82f6",overlayButton.style.border="none",overlayButton.style.borderRadius="25px",overlayButton.style.cursor="pointer",overlayButton.style.display="none",overlayButton.setAttribute("data-state","idle"),overlayButton.style.padding="0px";let currentStatus="idle";const loadingContainer=document.createElement("div");loadingContainer.style.position="relative",loadingContainer.style.display="flex",loadingContainer.style.justifyContent="center",loadingContainer.style.alignItems="center",loadingContainer.style.width="25px",loadingContainer.style.height="25px";const getLogo=(e="absolute")=>{var t=document.createElement("img");return t.id="logoImg",t.src="https://mindful-beans.netlify.app/static/media/logo.c1326f89940153adfbe4.png",t.alt="Logo",t.style.position=e,t.style.zIndex="2",t.style.width="25px",t.style.height="25px",t},getMessage=(e,t="5px",n="5px")=>{const o=document.createElement("div");return o.style.paddingLeft="5px",o.style.paddingRight="5px",o.style.color="white",o.style.fontSize="15px",o.style.fontWeight="bold",o.innerText=e,o};var spinner=document.createElement("div");spinner.classList.add("grow-pulse"),spinner.classList.add("spinner"),spinner.style.position="absolute",spinner.style.zIndex="1",spinner.style.width="25px",spinner.style.height="25px",loadingContainer.appendChild(spinner),loadingContainer.appendChild(getLogo("absolute"));const SuccessContainer=document.createElement("div");SuccessContainer.style.position="relative",SuccessContainer.style.display="flex",SuccessContainer.style.justifyContent="between",SuccessContainer.style.alignItems="center",SuccessContainer.style.height="25px",SuccessContainer.style.minWidth="50px",SuccessContainer.backgroundColor="rgba(59, 130, 246, 1)",SuccessContainer.appendChild(getLogo("relative")),SuccessContainer.appendChild(getMessage("Safe"));const SuggestionContainer=document.createElement("div");function showLoading(){overlayButton.innerHTML="",overlayButton.appendChild(loadingContainer),overlayButton.style.background="RGBA(241, 252, 254, 0)"}function hideLoading(){overlayButton.removeChild(loadingContainer)}function showSuccess(){overlayButton.appendChild(SuccessContainer),overlayButton.style.background="#023e8a",overlayButton.style.borderRadius="25px"}function hideSuccess(){overlayButton.removeChild(SuccessContainer),overlayButton.style.background="RGBA(241, 252, 254, 0)"}function positionOverlayButton(e){const t=e.getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight;t.top<n/2?(overlayButton.style.top=`${t.bottom+window.scrollY}px`,overlayButton.style.left=`${t.left+window.scrollX}px`):(overlayButton.style.top=t.top+window.scrollY-overlayButton.offsetHeight+"px",overlayButton.style.left=`${t.left+window.scrollX}px`)}function updateButtonState(e,t=[]){if(overlayButton.setAttribute("data-state",e),"suggestions"===e){currentStatus=e,overlayButton.innerHTML="",SuggestionContainer.innerHTML="",overlayButton.style.background="RGBA(241, 252, 254, 0)";const n=document.createElement("div");n.style.position="relative",n.style.display="flex",n.style.justifyContent="between",n.style.alignItems="center",n.style.height="25px",n.style.minWidth="50px",n.style.backgroundColor="rgba(59, 130, 246, 1)",n.style.borderRadius="25px",n.style.zIndex="4",n.appendChild(getLogo("relative")),n.appendChild(getMessage("Unsafe"));const o=document.createElement("div");o.style.background="#023e8a",o.style.borderRadius="10px",o.style.padding="8px",o.style.paddingLeft="10px",o.style.paddingRight="10px",o.style.position="absolute",o.style.zIndex="3",o.style.top="20px",o.style.left="10px",t.forEach((e=>{let t=document.createElement("p");t.innerText=e,t.style.color="white",t.style.fontSize="15px",t.style.fontWeight="bold",t.style.textAlign="left",t.style.maxWidth=maxElementWidth+"px",o.appendChild(t)})),SuggestionContainer.appendChild(n),SuggestionContainer.appendChild(o),overlayButton.appendChild(SuggestionContainer)}"success"===e&&(currentStatus!=e&&(hideLoading(),showSuccess(),currentStatus=e),clearTimeout(timeoutId),timeoutId=setTimeout((function(){hideSuccess(),overlayButton.style.display="none"}),5e3)),"processing"===e&&currentStatus!=e&&(showLoading(),currentStatus=e)}function captureUserInputs(){document.addEventListener("keydown",(function(e){const t=document.activeElement;if(t instanceof HTMLInputElement){const e=t.type;if("email"===e||"password"===e||"text"===e&&["username","user","login"].includes(t.name))return}const n=t.innerText||t.value;chrome.runtime.sendMessage({action:"logInput",inputValue:n}),overlayButton.style.display="block",positionOverlayButton(t)}))}function retrieveLocalStorageData(){"mindful-beans.netlify.app"==window.location.hostname&&(localStorage.length>0?chrome.runtime.sendMessage({localStorageData:localStorage,website:window.location.hostname}):setTimeout(retrieveLocalStorageData,500))}overlayButton.addEventListener("click",(()=>{chrome.runtime.sendMessage({action:"overlayClicked"})})),document.body.appendChild(overlayButton),chrome.runtime.onMessage.addListener((function(e,t,n){"updateButtonState"===e.action&&updateButtonState(e.state,e.suggestions)})),chrome.storage.local.get("inputPurification",(function(e){e.inputPurification&&document.addEventListener("keydown",captureUserInputs)})),chrome.storage.onChanged.addListener((function(e){e.inputPurification&&!e.inputPurification.newValue?(console.log("removed"),document.removeEventListener("keydown",captureUserInputs)):!e.inputPurification&&e.inputPurification.newValue&&document.addEventListener("keydown",captureUserInputs)})),retrieveLocalStorageData(),window.addEventListener("resize",(()=>{const e=document.activeElement;!e||"input"!==e.tagName.toLowerCase()&&"textarea"!==e.tagName.toLowerCase()||positionOverlayButton(e)}));const contentScanner=async e=>new Promise(((t,n)=>{try{const o=e.querySelectorAll('div[class="css-901oao r-18jsvk2 r-37j5jr r-a023e6 r-16dba41 r-rjixqe r-bcqeeo r-bnwqim r-qvutc0"]')[0];if(!o)return void n("");if(o.length>1){let e="";for(let t in o)e+=t.innerText;t(e)}else t(o.innerText)}catch(e){return void n("")}})),revealTweet=e=>{e.target.parentElement.setAttribute("hidden",""),e.target.parentElement.previousElementSibling.style.filter="blur(0px)"},getSentiment=async e=>{const t=await fetch("https://api-inference.huggingface.co/models/unitary/unbiased-toxic-roberta",{headers:{Authorization:"Bearer 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"},method:"POST",body:JSON.stringify(e)});return await t.json()},runTweetCheck=async e=>{try{for(let t of e){console.log(t.firstChild.childNodes.length);let e=await contentScanner(t);if(e){console.log("CLEANED TEXT\n"),console.log(e);{let e=t.children[0].children[0],n=document.createElement("div");n.addEventListener("click",(e=>revealTweet(e))),n.setAttribute("id","postInjected"),n.style.zIndex="100",n.innerHTML='\n            <button type="button" \n            style="cursor: pointer;border-radius: 5px;border: none;background-color: dodgerblue;color: white;padding: 10px 20px;margin: 0;position: absolute;top: 50%;left: 40%;transform: translateY(-50%, -40%);z-index: 100;">\n              Reveal Tweet\n            </button>\n          ',e.style.filter="blur(15px)",e.parentElement.appendChild(n)}}}}catch(e){console.log(e)}},mutationScanner=function(){var e=window.MutationObserver||window.WebKitMutationObserver;return function(t,n){if(t&&1===t.nodeType){if(e){var o=new e(n);return o.observe(t,{childList:!0,subtree:!1}),o}window.addEventListener&&(t.addEventListener("DOMNodeInserted",n,!1),t.addEventListener("DOMNodeRemoved",n,!1))}}}(),main=async(e,t)=>{await e().then((n=>{null==n&&setTimeout((()=>main(e,t)),1300),t(n)}))},getPostsContainer=async()=>new Promise(((e,t)=>{try{e(document.querySelectorAll('div[aria-label^="Timeline: Your Home Timeline"] > div')[0])}catch(e){console.log(e),t("Failed to retrieve tweets")}})),processPostsContainer=async e=>{try{runTweetCheck(e.children),mutationScanner(e,(function(e){const t=[];e.forEach((e=>{e.addedNodes.length,t.push(...e.addedNodes)})),runTweetCheck(t)}))}catch(e){console.log(e)}};(async()=>{main(getPostsContainer,processPostsContainer)})();