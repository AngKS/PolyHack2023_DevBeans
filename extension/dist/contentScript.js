let timeoutId=null;const overlayButton=document.createElement("button");overlayButton.innerText="Overlay",overlayButton.style.position="absolute",overlayButton.style.zIndex="2147483647",overlayButton.style.background="#F1FCFE",overlayButton.style.color="#3b82f6",overlayButton.style.border="none",overlayButton.style.borderRadius="25px",overlayButton.style.cursor="pointer",overlayButton.style.display="none",overlayButton.setAttribute("data-state","idle"),overlayButton.style.padding="0px";let currentStatus="idle";const loadingContainer=document.createElement("div");loadingContainer.style.position="relative",loadingContainer.style.display="flex",loadingContainer.style.justifyContent="center",loadingContainer.style.alignItems="center",loadingContainer.style.width="25px",loadingContainer.style.height="25px";const getLogo=(e="absolute")=>{var t=document.createElement("img");return t.id="logoImg",t.src="https://mindful-beans.netlify.app/static/media/logo.c1326f89940153adfbe4.png",t.alt="Logo",t.style.position=e,t.style.zIndex="2",t.style.width="25px",t.style.height="25px",t},getMessage=e=>{const t=document.createElement("div");return t.style.paddingLeft="5px",t.style.paddingRight="5px",t.style.color="white",t.style.fontSize="15px",t.style.fontWeight="bold",t.innerText=e,t};var spinner=document.createElement("div");spinner.classList.add("grow-pulse"),spinner.classList.add("spinner"),spinner.style.position="absolute",spinner.style.zIndex="1",spinner.style.width="25px",spinner.style.height="25px",loadingContainer.appendChild(spinner),loadingContainer.appendChild(getLogo("absolute"));const SuccessContainer=document.createElement("div");function showLoading(){overlayButton.innerHTML="",overlayButton.appendChild(loadingContainer),overlayButton.style.background="RGBA(241, 252, 254, 0)"}function hideLoading(){overlayButton.removeChild(loadingContainer),overlayButton.appendChild(SuccessContainer),overlayButton.style.background="#023e8a"}function positionOverlayButton(e){const t=e.getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight;t.top<n/2?(overlayButton.style.top=`${t.bottom+window.scrollY}px`,overlayButton.style.left=`${t.left+window.scrollX}px`):(overlayButton.style.top=t.top+window.scrollY-overlayButton.offsetHeight+"px",overlayButton.style.left=`${t.left+window.scrollX}px`)}function updateButtonState(e,t=[]){if(overlayButton.setAttribute("data-state",e),"suggestions"===e){const e=document.createElement("div");e.style.position="relative",e.style.display="flex",e.style.justifyContent="between",e.style.alignItems="center",e.style.height="25px",e.style.minWidth="50px",e.backgroundColor="rgba(59, 130, 246, 1)",e.style.maxWidth="80%",SuccessContainer.appendChild(getLogo("relative")),SuccessContainer.appendChild(successMessage);let n=document.createElement("div");n.className="suggestion-dropdown",t.forEach((e=>{let t=document.createElement("p");t.innerText=e,n.appendChild(t)})),overlayButton.appendChild(n)}"success"===e&&(currentStatus!=e&&(hideLoading(),currentStatus=e),clearTimeout(timeoutId),timeoutId=setTimeout((function(){overlayButton.style.display="none"}),5e3)),"processing"===e&&currentStatus!=e&&(showLoading(),currentStatus=e)}function captureUserInputs_(){document.addEventListener("keydown",(function(e){const t=document.activeElement,n=t.innerText||t.value;chrome.runtime.sendMessage({action:"logInput",inputValue:n}),overlayButton.style.display="block",positionOverlayButton(t)}))}function captureUserInputs(){document.addEventListener("keydown",(function(e){const t=document.activeElement;if(t instanceof HTMLInputElement){const e=t.type;if("email"===e||"password"===e||"text"===e&&["username","user","login"].includes(t.name))return}const n=t.innerText||t.value;chrome.runtime.sendMessage({action:"logInput",inputValue:n}),overlayButton.style.display="block",positionOverlayButton(t)}))}function retrieveLocalStorageData(){"mindful-beans.netlify.app"==window.location.hostname&&(localStorage.length>0?chrome.runtime.sendMessage({localStorageData:localStorage,website:window.location.hostname}):setTimeout(retrieveLocalStorageData,500))}SuccessContainer.style.position="relative",SuccessContainer.style.display="flex",SuccessContainer.style.justifyContent="between",SuccessContainer.style.alignItems="center",SuccessContainer.style.height="25px",SuccessContainer.style.minWidth="50px",SuccessContainer.backgroundColor="rgba(59, 130, 246, 1)",SuccessContainer.appendChild(getLogo("relative")),SuccessContainer.appendChild(getMessage("Safe")),overlayButton.addEventListener("click",(()=>{chrome.runtime.sendMessage({action:"overlayClicked"})})),document.body.appendChild(overlayButton),chrome.runtime.onMessage.addListener((function(e,t,n){"updateButtonState"===e.action&&updateButtonState(e.state,e.suggestions)})),captureUserInputs(),retrieveLocalStorageData(),window.addEventListener("resize",(()=>{const e=document.activeElement;!e||"input"!==e.tagName.toLowerCase()&&"textarea"!==e.tagName.toLowerCase()||positionOverlayButton(e)}));const observer=new MutationObserver((function(e){for(const t of e)if("childList"===t.type){const e=document.documentElement.innerText;console.log(e);const t=document.head.getElementsByTagName("meta");for(let e=0;e<t.length;e++){const n=t[e],o=n.getAttribute("name"),s=(n.getAttribute("property"),n.getAttribute("content"));if("description"===o){const e=s;console.log("Description:",e)}if("keywords"===o){const e=s;console.log("Keywords:",e)}}chrome.runtime.sendMessage({pageContent:e,currentWebsite:window.location.hostname})}}));observer.observe(document,{childList:!0,subtree:!0});